layui.define("form",function(z){var g=layui.$,b=layui.form,y=layui.layer,k="tree",m={config:{},index:layui[k]?(layui[k].index+10000):0,set:function(A){var B=this;B.config=g.extend({},B.config,A);return B},on:function(A,B){return layui.onevent.call(this,k,A,B)}},a=function(){var B=this,A=B.config,C=A.id||B.index;a.that[C]=B;a.config[C]=A;return{config:A,reload:function(D){B.reload.call(B,D)},getChecked:function(){return B.getChecked.call(B)},setChecked:function(D){return B.setChecked.call(B,D)}}},w=function(B){var A=a.config[B];if(!A){hint.error("The ID option was not found in the "+k+" instance")}return A||null},f="layui-show",s="layui-hide",j="layui-none",t="layui-disabled",v="layui-tree",d="layui-tree-set",u="layui-tree-iconClick",n="layui-icon-addition",i="layui-icon-subtraction",l="layui-tree-entry",p="layui-tree-main",x="layui-tree-txt",e="layui-tree-pack",o="layui-tree-spread",q="layui-tree-setLineShort",h="layui-tree-showLine",c="layui-tree-lineExtend",r=function(A){var B=this;B.index=++m.index;B.config=g.extend({},B.config,m.config,A);B.render()};r.prototype.config={data:[],showCheckbox:false,showLine:true,accordion:false,onlyIconControl:false,isJump:false,edit:false,text:{defaultNodeName:"未命名",none:"无数据"}};r.prototype.reload=function(A){var B=this;layui.each(A,function(C,D){if(D.constructor===Array){delete B.config[C]}});B.config=g.extend(true,{},B.config,A);B.render()};r.prototype.render=function(){var C=this,B=C.config;C.checkids=[];var A=g('<div class="layui-tree'+(B.showCheckbox?" layui-form":"")+(B.showLine?" layui-tree-line":"")+'" lay-filter="LAY-tree-'+C.index+'"></div>');C.tree(A);var D=B.elem=g(B.elem);if(!D[0]){return}C.key=B.id||C.index;C.elem=A;C.elemNone=g('<div class="layui-tree-emptyText">'+B.text.none+"</div>");D.html(C.elem);if(C.elem.find(".layui-tree-set").length==0){return C.elem.append(C.elemNone)}if(B.showCheckbox){C.renderForm("checkbox")}C.elem.find(".layui-tree-set").each(function(){var E=g(this);if(!E.parent(".layui-tree-pack")[0]){E.addClass("layui-tree-setHide")}if(!E.next()[0]&&E.parents(".layui-tree-pack").eq(1).hasClass("layui-tree-lineExtend")){E.addClass(q)}if(!E.next()[0]&&!E.parents(".layui-tree-set").eq(0).next()[0]){E.addClass(q)}});C.events()};r.prototype.renderForm=function(A){b.render(A,"LAY-tree-"+this.index)};r.prototype.tree=function(D,B){var C=this,A=C.config,E=B||A.data;layui.each(E,function(G,I){var J=I.children&&I.children.length>0,H=g('<div class="layui-tree-pack" '+(I.spread?'style="display: block;"':"")+'"></div>'),F=g(['<div data-id="'+I.id+'" class="layui-tree-set'+(I.spread?" layui-tree-spread":"")+(I.checked?" layui-tree-checkedFirst":"")+'">','<div class="layui-tree-entry">','<div class="layui-tree-main">',function(){if(A.showLine){if(J){return'<span class="layui-tree-iconClick layui-tree-icon"><i class="layui-icon '+(I.spread?"layui-icon-subtraction":"layui-icon-addition")+'"></i></span>'}else{return'<span class="layui-tree-iconClick"><i class="layui-icon layui-icon-file"></i></span>'}}else{return'<span class="layui-tree-iconClick"><i class="layui-tree-iconArrow '+(J?"":s)+'"></i></span>'}}(),function(){return A.showCheckbox?'<input type="checkbox" name="'+(I.field||("layuiTreeCheck_"+I.id))+'" same="layuiTreeCheck" lay-skin="primary" '+(I.disabled?"disabled":"")+' value="'+I.id+'">':""}(),function(){if(A.isJump&&I.href){return'<a href="'+I.href+'" target="_blank" class="'+x+'">'+(I.title||I.label||A.text.defaultNodeName)+"</a>"}else{return'<span class="'+x+(I.disabled?" "+t:"")+'">'+(I.title||I.label||A.text.defaultNodeName)+"</span>"}}(),"</div>",function(){if(!A.edit){return""}var L={add:'<i class="layui-icon layui-icon-add-1"  data-type="add"></i>',update:'<i class="layui-icon layui-icon-edit" data-type="update"></i>',del:'<i class="layui-icon layui-icon-delete" data-type="del"></i>'},K=['<div class="layui-btn-group layui-tree-btnGroup">'];if(A.edit===true){A.edit=["update","del"]}if(typeof A.edit==="object"){layui.each(A.edit,function(M,N){K.push(L[N]||"")});return K.join("")+"</div>"}}(),"</div></div>"].join(""));if(J){F.append(H);C.tree(H,I.children)}D.append(F);if(F.prev("."+d)[0]){F.prev().children(".layui-tree-pack").addClass("layui-tree-showLine")}if(!J){F.parent(".layui-tree-pack").addClass("layui-tree-lineExtend")}C.spread(F,I);if(A.showCheckbox){I.checked&&C.checkids.push(I.id);C.checkClick(F,I)}A.edit&&C.operate(F,I)})};r.prototype.spread=function(C,I){var E=this,J=E.config,F=C.children("."+l),D=F.children("."+p),G=F.find("."+u),B=F.find("."+x),H=J.onlyIconControl?G:D,A="";H.on("click",function(M){var K=C.children("."+e),N=H.children(".layui-icon")[0]?H.children(".layui-icon"):H.find(".layui-tree-icon").children(".layui-icon");if(!K[0]){A="normal"}else{if(C.hasClass(o)){C.removeClass(o);K.slideUp(200);A="close";N.removeClass(i).addClass(n)}else{C.addClass(o);K.slideDown(200);A="open";N.addClass(i).removeClass(n);if(J.accordion){var L=C.siblings("."+d);L.removeClass(o);L.children("."+e).slideUp(200);L.find(".layui-tree-icon").children(".layui-icon").removeClass(i).addClass(n)}}J.touchOpen&&J.touchOpen({elem:C,state:A,data:I})}});B.on("click",function(){var K=g(this);if(K.hasClass(t)){return}if(C.hasClass(o)){A=J.onlyIconControl?"open":"close"}else{A=J.onlyIconControl?"close":"open"}J.click&&J.click({elem:C,state:A,data:I})})};r.prototype.setCheckbox=function(F,E,A){var D=this,B=D.config,C=A.prop("checked");if(A.prop("disabled")){return}if(typeof E.children==="object"||F.find("."+e)[0]){var G=F.find("."+e).find('input[same="layuiTreeCheck"]');G.each(function(){if(this.disabled){return}this.checked=C})}var H=function(M){if(!M.parents("."+d)[0]){return}var K,L=M.parent("."+e),I=L.parent(),J=L.prev().find('input[same="layuiTreeCheck"]');if(C){J.prop("checked",C)}else{L.find('input[same="layuiTreeCheck"]').each(function(){if(this.checked){K=true}});K||J.prop("checked",false)}H(I)};H(F);D.renderForm("checkbox")};r.prototype.checkClick=function(F,E){var D=this,A=D.config,C=F.children("."+l),B=C.children("."+p);B.on("click",'input[same="layuiTreeCheck"]+',function(I){layui.stope(I);var G=g(this).prev(),H=G.prop("checked");if(G.prop("disabled")){return}D.setCheckbox(F,E,G);A.oncheck&&A.oncheck({elem:F,checked:H,data:E})})};r.prototype.operate=function(F,E){var D=this,A=D.config,C=F.children("."+l),B=C.children("."+p);C.children(".layui-tree-btnGroup").on("click",".layui-icon",function(I){layui.stope(I);var J=g(this).data("type"),Q=F.children("."+e),N={data:E,type:J,elem:F};if(J=="add"){if(!Q[0]){if(A.showLine){B.find("."+u).addClass("layui-tree-icon");B.find("."+u).children(".layui-icon").addClass(n).removeClass("layui-icon-file")}else{B.find(".layui-tree-iconArrow").removeClass(s)}F.append('<div class="layui-tree-pack"></div>')}var O=A.operate&&A.operate(N),G={};if(O===false){return}G.title=A.text.defaultNodeName;G.id=O;D.tree(F.children("."+e),[G]);if(A.showLine){if(!Q[0]){var K=F.siblings("."+d),H=1,R=F.parent("."+e);layui.each(K,function(S,T){if(!g(T).children("."+e)[0]){H=0}});if(H==1){K.children("."+e).addClass(h);K.children("."+e).children("."+d).removeClass(q);F.children("."+e).addClass(h);R.removeClass(c);R.children("."+d).last().children("."+e).children("."+d).last().addClass(q)}else{F.children("."+e).children("."+d).addClass(q)}}else{if(!Q.hasClass(c)){Q.addClass(c)}F.find("."+e).each(function(){g(this).children("."+d).last().addClass(q)});if(Q.children("."+d).last().prev().hasClass(q)){Q.children("."+d).last().prev().removeClass(q)}else{Q.children("."+d).last().removeClass(q)}if(!F.parent("."+e)[0]&&F.next()[0]){Q.children("."+d).last().removeClass(q)}}}if(!A.showCheckbox){return}if(B.find('input[same="layuiTreeCheck"]')[0].checked){var M=F.children("."+e).children("."+d).last();M.find('input[same="layuiTreeCheck"]')[0].checked=true}D.renderForm("checkbox")}else{if(J=="update"){var P=B.children("."+x).html();B.children("."+x).html("");B.append('<input type="text" class="layui-tree-editInput">');B.children(".layui-tree-editInput").val(P).focus();var L=function(S){var U=S.val().trim();U=U?U:A.text.defaultNodeName;S.remove();B.children("."+x).html(U);var T=N.data.title;N.data.title=U;if(!A.operate){return}if(A.operate(N)===false){N.data.title=T;B.children("."+x).html(T)}};B.children(".layui-tree-editInput").blur(function(){L(g(this))});B.children(".layui-tree-editInput").on("keydown",function(S){if(S.keyCode===13){S.preventDefault();L(g(this))}})}else{y.confirm('确认删除该节点 "<span style="color: #999;">'+(E.title||"")+'</span>" 吗？',function(U){y.close(U);if(A.operate&&A.operate(N)===false){return}N.status="remove";if(!F.prev("."+d)[0]&&!F.next("."+d)[0]&&!F.parent("."+e)[0]){F.remove();D.elem.append(D.elemNone);return}if(F.siblings("."+d).children("."+l)[0]){if(A.showCheckbox){var V=function(ac){if(!ac.parents("."+d)[0]){return}var ae=ac.siblings("."+d).children("."+l),ab=ac.parent("."+e).prev(),aa=ab.find('input[same="layuiTreeCheck"]')[0],ad=1,Z=0;if(aa.checked==false){ae.each(function(ah,ag){var af=g(ag).find('input[same="layuiTreeCheck"]')[0];if(af.checked==false&&!af.disabled){ad=0}if(!af.disabled){Z=1}});if(ad==1&&Z==1){aa.checked=true;D.renderForm("checkbox");V(ab.parent("."+d))}}};V(F)}if(A.showLine){var Y=F.siblings("."+d),T=1,X=F.parent("."+e);layui.each(Y,function(Z,aa){if(!g(aa).children("."+e)[0]){T=0}});if(T==1){if(!Q[0]){X.removeClass(c);Y.children("."+e).addClass(h);Y.children("."+e).children("."+d).removeClass(q)}if(!F.next()[0]){F.prev().children("."+e).children("."+d).last().addClass(q)}else{X.children("."+d).last().children("."+e).children("."+d).last().addClass(q)}if(!F.next()[0]&&!F.parents("."+d)[1]&&!F.parents("."+d).eq(0).next()[0]){F.prev("."+d).addClass(q)}}else{if(!F.next()[0]&&F.hasClass(q)){F.prev().addClass(q)}}}}else{var S=F.parent("."+e).prev();if(A.showLine){S.find("."+u).removeClass("layui-tree-icon");S.find("."+u).children(".layui-icon").removeClass(i).addClass("layui-icon-file");var W=S.parents("."+e).eq(0);W.addClass(c);W.children("."+d).each(function(){g(this).children("."+e).children("."+d).last().addClass(q)})}else{S.find(".layui-tree-iconArrow").addClass(s)}F.parents("."+d).eq(0).removeClass(o);F.parent("."+e).remove()}F.remove()})}}})};r.prototype.events=function(){var C=this,B=C.config,A=C.elem.find(".layui-tree-checkedFirst");C.setChecked(C.checkids);C.elem.find(".layui-tree-search").on("keyup",function(){var E=g(this),G=E.val(),F=E.nextAll(),D=[];F.find("."+x).each(function(){var I=g(this).parents("."+l);if(g(this).html().indexOf(G)!=-1){D.push(g(this).parent());var H=function(J){J.addClass("layui-tree-searchShow");if(J.parent("."+e)[0]){H(J.parent("."+e).parent("."+d))}};H(I.parent("."+d))}});F.find("."+l).each(function(){var H=g(this).parent("."+d);if(!H.hasClass("layui-tree-searchShow")){H.addClass(s)}});if(F.find(".layui-tree-searchShow").length==0){C.elem.append(C.elemNone)}B.onsearch&&B.onsearch({elem:D})});C.elem.find(".layui-tree-search").on("keydown",function(){g(this).nextAll().find("."+l).each(function(){var D=g(this).parent("."+d);D.removeClass("layui-tree-searchShow "+s)});if(g(".layui-tree-emptyText")[0]){g(".layui-tree-emptyText").remove()}})};r.prototype.getChecked=function(){var E=this,B=E.config,D=[],A=[];E.elem.find(".layui-form-checked").each(function(){D.push(g(this).prev()[0].value)});var C=function(G,F){layui.each(G,function(H,I){layui.each(D,function(L,J){if(I.id==J){var K=g.extend({},I);delete K.children;F.push(K);if(I.children){K.children=[];C(I.children,K.children)}return true}})})};C(g.extend({},B.data),A);return A};r.prototype.setChecked=function(A){var C=this,B=C.config;C.elem.find("."+d).each(function(G,H){var E=g(this).data("id"),F=g(H).children("."+l).find('input[same="layuiTreeCheck"]'),D=F.next();if(typeof A==="number"){if(E==A){if(!F[0].checked){D.click()}return false}}else{if(typeof A==="object"){layui.each(A,function(I,J){if(J==E&&!F[0].checked){D.click();return true}})}}})};a.that={};a.config={};m.reload=function(C,A){var B=a.that[C];B.reload(A);return a.call(B)};m.getChecked=function(B){var A=a.that[B];return A.getChecked()};m.setChecked=function(C,A){var B=a.that[C];return B.setChecked(A)};m.render=function(A){var B=new r(A);return a.call(B)};z(k,m)});